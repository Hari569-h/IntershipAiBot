name: Auto Run Internship Bot

on:
  schedule:
    - cron: '0 */6 * * *'  # Every 6 hours
  workflow_dispatch:       # Manual trigger support

jobs:
  auto-run:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          playwright install chromium

      - name: Run automation script
        run: python run_automation.py
        env:
          # AI API Keys
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          COHERE_API_KEY: ${{ secrets.COHERE_API_KEY }}
          OPENROUTER_API_KEY: ${{ secrets.OPENROUTER_API_KEY }}

          # Job Platform Credentials
          LINKEDIN_EMAIL: ${{ secrets.LINKEDIN_EMAIL }}
          LINKEDIN_PASSWORD: ${{ secrets.LINKEDIN_PASSWORD }}
          INTERNSHALA_EMAIL: ${{ secrets.INTERNSHALA_EMAIL }}
          INTERNSHALA_PASSWORD: ${{ secrets.INTERNSHALA_PASSWORD }}
          INDEED_EMAIL: ${{ secrets.INDEED_EMAIL }}
          INDEED_PASSWORD: ${{ secrets.INDEED_PASSWORD }}

          # Application Settings
          SIMILARITY_THRESHOLD: ${{ secrets.SIMILARITY_THRESHOLD }}
          APPLICATION_DELAY: ${{ secrets.APPLICATION_DELAY }}
          MAX_APPLICATIONS_PER_DAY: ${{ secrets.MAX_APPLICATIONS_PER_DAY }}

          # Logging
          LOG_LEVEL: ${{ secrets.LOG_LEVEL }}
          LOG_FILE: auto_run.log

          # Email Notification Settings
          EMAIL_SENDER: ${{ secrets.EMAIL_SENDER }}
          EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
          EMAIL_RECIPIENT: ${{ secrets.EMAIL_RECIPIENT }}
          SMTP_SERVER: ${{ secrets.SMTP_SERVER }}
          SMTP_PORT: ${{ secrets.SMTP_PORT }}
          EMAIL_MAX_RETRIES: ${{ secrets.EMAIL_MAX_RETRIES }}
          EMAIL_RETRY_DELAY: ${{ secrets.EMAIL_RETRY_DELAY }}
          EMAIL_NOTIFICATIONS_ENABLED: "true"
